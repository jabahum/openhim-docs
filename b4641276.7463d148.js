/*! For license information please see b4641276.7463d148.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[172],{255:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return i})),a.d(t,"rightToc",(function(){return l})),a.d(t,"default",(function(){return u}));a(0);var n=a(325),r=a(327),s=a(328);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e}).apply(this,arguments)}const i={id:"create",title:"Create User",sidebar_label:"Create",keywords:["OpenHIM","API","User","Create"],description:"Create an OpenHIM User via the API"},l=[{value:"Create User",id:"create-user",children:[]},{value:"Example",id:"example",children:[]}],c={rightToc:l},p="wrapper";function u({components:e,...t}){return Object(n.b)(p,o({},c,t,{components:e,mdxType:"MDXLayout"}),Object(n.b)("h2",{id:"create-user"},"Create User"),Object(n.b)("p",null,"To create a user, you will need to make a TLS request to the OpenHIM API for the below method and endpoint and supply the JSON object for the user."),Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{className:"language-curl"}),"Method: POST\nEndpoint: {openhim_url}:8080/users\nPayload: JSON object of the user\n")),Object(n.b)("h2",{id:"example"},"Example"),Object(n.b)(r.a,{defaultValue:"lang",values:[{label:"Languages",value:"lang"},{label:"Sample Data",value:"sample"}],mdxType:"Tabs"},Object(n.b)(s.a,{value:"lang",mdxType:"TabItem"},Object(n.b)("p",null,"  Before we can send our request to the OpenHIM API we need to ensure that we construct our valid HTTP headers to successfully authenticate with the OpenHIM API."),Object(n.b)(r.a,{defaultValue:"nodejs",values:[{label:"NodeJS",value:"nodejs"},{label:"Bash",value:"bash"}],mdxType:"Tabs"},Object(n.b)(s.a,{value:"nodejs",mdxType:"TabItem"},Object(n.b)("p",null,"  Copy the below code at the bottom of your nodejs script that handles the authentication of the OpenHIM headers as described in the ",Object(n.b)("a",o({parentName:"p"},{href:"../introduction/authentication"}),"authentication section"),"."),Object(n.b)("p",null,"  Replace the ",Object(n.b)("inlineCode",{parentName:"p"},"openhimOptions")," values with the correct implementation details and supply the ",Object(n.b)("inlineCode",{parentName:"p"},"SampleData")," payload to submit. You will also need to update the userPassword variable to your desired password. The password will be used to create the passwordHash and passwordSalt, which are added to the ",Object(n.b)("inlineCode",{parentName:"p"},"SampleData")," payload."),Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{className:"language-javascript"}),"// append below code to the \"openhim-api.js\" script containing the authentication methods.\n// This is described within the authentication section\n\nconst genUserPassword = (password) => {\n  return new Promise((resolve) => {\n    const passwordSalt = crypto.randomBytes(16)\n\n    // create passhash\n    let shasum = crypto.createHash('sha512')\n    shasum.update(password)\n    shasum.update(passwordSalt.toString('hex'))\n    const passwordHash = shasum.digest('hex')\n\n    resolve({\n      \"passwordSalt\": passwordSalt.toString('hex'),\n      \"passwordHash\": passwordHash\n    })\n  })\n}\n\n(async () => {\n  const openhimOptions = {\n    apiURL: 'https://localhost:8080',\n    apiEndpoint: '/users',\n    username: 'root@openhim.org',\n    password: 'openhim-password',\n    rejectUnauthorized: false\n  }\n\n  const userPassword = \"user-password\"\n  const userPasswordDetails = await genUserPassword(userPassword)\n\n  const SampleData = 'SampleData'\n\n  SampleData.passwordHash = userPasswordDetails.passwordHash\n  SampleData.passwordSalt = userPasswordDetails.passwordSalt\n\n  const headers = await genAuthHeaders(openhimOptions)\n\n  const options = {\n    method: 'POST',\n    url: `${openhimOptions.apiURL}${openhimOptions.apiEndpoint}`,\n    rejectUnauthorized: openhimOptions.rejectUnauthorized,\n    headers: headers,\n    body: SampleData,\n    json: true\n  }\n\n  request(options, (error, response, body) => {\n    if (error) throw new Error(error)\n\n    console.log({\n      statusCode: response.statusCode,\n      body\n    })\n  })\n})()\n")),Object(n.b)("p",null,"  Execute the below command in your terminal to run the nodejs script"),Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{className:"language-bash"}),"node openhim-api.js\n"))),Object(n.b)(s.a,{value:"bash",mdxType:"TabItem"},Object(n.b)("p",null,"  Ensure that you have created your bash script to construct the HTTP authentication headers and send the request to the OpenHIM API as described in the ",Object(n.b)("a",o({parentName:"p"},{href:"../introduction/authentication"}),"authentication section"),"."),Object(n.b)("p",null,"  To create a user, you first need to generate a password hash and salt. The script below can be used for this"),Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{className:"language-curl"}),'# gen-user-password.sh\n\n#!/bin/bash\nif (( $# < 1)); then\n    echo "OpenHIM User Password: Curl wrapper that generates the user Password details";\n    echo "Usage: $0 PASSWORD";\n    exit 0;\nfi\npass=$1;\nshift;\nshift;\n\nsalt=`cat /dev/urandom | tr -dc \'abcdef0-9\' | fold -w 32 | head -n 1`;\npasshash=`echo -n "$pass$salt" | shasum -a 512 | awk \'{print $1}\'`;\n\necho Password Salt: $salt\necho Password Hash: $passhash\n\necho "";\n')),Object(n.b)("p",null,"  Copy and execute the bash script above with the below command. Substitute the <USER_PASSWORD> with your desired password before executing."),Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{className:"language-curl"}),"./gen-user-password.sh <USER_PASSWORD>\n")),Object(n.b)("p",null,"  Execute the below command in your terminal where the file is located with the required arguments to create the user. Replace the placeholder arguments with the correct implementation details and ensure your ",Object(n.b)("inlineCode",{parentName:"p"},"SampleData.json")," file exists with the user object. Add the generated passwordHash and passwordSalt to the ",Object(n.b)("inlineCode",{parentName:"p"},"SampleData.json")," before executing the command."),Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{className:"language-curl"}),'./openhim-api.sh root@openhim.org openhim-password -v https://localhost:8080/users -d @SampleData.json -H "Content-Type:application/json"\n')))),Object(n.b)("p",null,"  The response status will be ",Object(n.b)("inlineCode",{parentName:"p"},"201")," if successful."),Object(n.b)("p",null,"  Once created, a user's activation email is sent to the users email. For this email to be sent, the OpenHIM needs to be configured with the correct mail settings. This can be\ndone in the ",Object(n.b)("a",o({parentName:"p"},{href:"https://github.com/jembi/openhim-core-js/blob/master/config/default.json#L66"}),"configuration"))),Object(n.b)(s.a,{value:"sample",mdxType:"TabItem"},Object(n.b)("pre",null,Object(n.b)("code",o({parentName:"pre"},{className:"language-json"}),'{\n  "settings": {\n    "list": {},\n    "filter": {\n      "limit":100\n    }\n  },\n  "groups": ["root@openhim.org"],\n  "email": "root2@openhim.org",\n  "firstname": "Test",\n  "surname": "Tester",\n  "msisdn": "",\n  "passwordAlgorithm": "sha512",\n  "passwordSalt": "32d0efc6add6dbd29ed46060a2744e0f",\n  "passwordHash": "9362d691a255ffa5c3d1c4992c31d96ea1f3cf71edc4f17685a29d634eaf9849e2d7a4f7237b7b2bca2fb17cee7ec05b4b9cae82c50a81158c45117136c9b3b7"\n}\n')))))}u.isMDXComponent=!0},325:function(e,t,a){"use strict";a.d(t,"a",(function(){return i})),a.d(t,"b",(function(){return u}));var n=a(0),r=a.n(n),s=r.a.createContext({}),o=function(e){var t=r.a.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):Object.assign({},t,e)),a},i=function(e){var t=o(e.components);return r.a.createElement(s.Provider,{value:t},e.children)};var l="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},p=Object(n.forwardRef)((function(e,t){var a=e.components,n=e.mdxType,s=e.originalType,i=e.parentName,l=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&-1===t.indexOf(n)&&(a[n]=e[n]);return a}(e,["components","mdxType","originalType","parentName"]),p=o(a),u=n,d=p[i+"."+u]||p[u]||c[u]||s;return a?r.a.createElement(d,Object.assign({},{ref:t},l,{components:a})):r.a.createElement(d,Object.assign({},{ref:t},l))}));function u(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var s=a.length,o=new Array(s);o[0]=p;var i={};for(var c in t)hasOwnProperty.call(t,c)&&(i[c]=t[c]);i.originalType=e,i[l]="string"==typeof e?e:n,o[1]=i;for(var u=2;u<s;u++)o[u]=a[u];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}p.displayName="MDXCreateElement"},326:function(e,t,a){var n;!function(){"use strict";var a={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var n=arguments[t];if(n){var s=typeof n;if("string"===s||"number"===s)e.push(n);else if(Array.isArray(n)&&n.length){var o=r.apply(null,n);o&&e.push(o)}else if("object"===s)for(var i in n)a.call(n,i)&&n[i]&&e.push(i)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(n=function(){return r}.apply(t,[]))||(e.exports=n)}()},327:function(e,t,a){"use strict";var n=a(0),r=a.n(n),s=a(326),o=a.n(s);t.a=function(e){const{block:t,children:a,defaultValue:s,values:i}=e,[l,c]=Object(n.useState)(s);return r.a.createElement("div",null,r.a.createElement("ul",{className:o()("tabs",{"tabs--block":t})},i.map(({value:e,label:t})=>r.a.createElement("li",{className:o()("tab-item",{"tab-item--active":l===e}),key:e,onClick:()=>c(e)},t))),r.a.createElement("div",{className:"margin-vert--md"},n.Children.toArray(a).filter(e=>e.props.value===l)[0]))}},328:function(e,t,a){"use strict";var n=a(0),r=a.n(n);t.a=function(e){return r.a.createElement("div",null,e.children)}}}]);