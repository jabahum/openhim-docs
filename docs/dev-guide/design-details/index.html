<!DOCTYPE html>
<html lang="en" data-theme="">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<script type="text/javascript">/*<![CDATA[*/window.__chunkMapping={"16017120":["/16017120.ab8b1cdb.js"],"17896441":["/17896441.5eb77786.css","/17896441.a0636878.js"],"34342401":["/34342401.b1709367.js"],"47325611":["/47325611.a89aad07.js"],"60415478":["/60415478.403d1d58.js"],"87623997":["/87623997.048208dd.js"],"main":["/main.890859af.css","/main.8982d4c2.js"],"01a85c17":["/01a85c17.2fb6e6c7.js"],"026297e9":["/026297e9.8c117cdd.js"],"02ab9906":["/02ab9906.5da9f5fa.js"],"02bd7a42":["/02bd7a42.66106e49.js"],"03996ad0":["/03996ad0.3b47b3bd.js"],"0759d27c":["/0759d27c.1c66fc67.js"],"09ce1a73":["/09ce1a73.38a8ef6e.js"],"0b1835ba":["/0b1835ba.98448f0c.js"],"0b4fad2c":["/0b4fad2c.72ca5c3b.js"],"0d0770a2":["/0d0770a2.aeca4253.js"],"0ee2d32f":["/0ee2d32f.f14c6b5d.js"],"12852a89":["/12852a89.8f7bf043.js"],"15aa40f4":["/15aa40f4.8212967f.js"],"15c6fb24":["/15c6fb24.e6752b9e.js"],"15fe0cce":["/15fe0cce.3b1ee076.js"],"1640328c":["/1640328c.8deae2c1.js"],"165e6236":["/165e6236.61f55ebe.js"],"1742cf79":["/1742cf79.0de93cc2.js"],"1794f23b":["/1794f23b.fb02233a.js"],"19ca43e5":["/19ca43e5.e7ebf24c.js"],"1a6dbedf":["/1a6dbedf.c99e99a8.js"],"1a9639fa":["/1a9639fa.0fd6e20f.js"],"1b2d43c1":["/1b2d43c1.d125acb2.js"],"1b305ec6":["/1b305ec6.e059146a.js"],"1be78505":["/1be78505.a7dc664a.css","/1be78505.07533e7a.js"],"1c0b5c90":["/1c0b5c90.f72ad746.js"],"1ef78522":["/1ef78522.525f7c42.js"],"1f7aab8b":["/1f7aab8b.0cbb4700.js"],"2228847d":["/2228847d.92dbddec.js"],"238f6119":["/238f6119.2bc2ad42.js"],"2450005c":["/2450005c.6cac036b.js"],"24bc38f7":["/24bc38f7.cfb10056.js"],"253ba960":["/253ba960.aa1f2384.js"],"25f4ba9f":["/25f4ba9f.7cf2c1ee.js"],"25fd0e67":["/25fd0e67.4bd673ad.js"],"26e7956e":["/26e7956e.457324fd.js"],"2868cdab":["/2868cdab.05674fae.js"],"28a932df":["/28a932df.c1caab6b.js"],"2a2fdaf6":["/2a2fdaf6.1ec01905.js"],"2a912e67":["/2a912e67.a7dbebdc.js"],"2e254a3f":["/2e254a3f.0d29aaed.js"],"2eb300d6":["/2eb300d6.e7c3979d.js"],"30cb528f":["/30cb528f.f950d8ea.js"],"32849e0e":["/32849e0e.89c7cc68.js"],"33fa20e6":["/33fa20e6.960a24b7.js"],"34684d79":["/34684d79.6ae77577.js"],"3523e5ba":["/3523e5ba.bbcd3014.js"],"3570154c":["/3570154c.b51818b5.js"],"359fe6a9":["/359fe6a9.dc673daa.js"],"35b5d9ba":["/35b5d9ba.4588df97.js"],"35c1b2a3":["/35c1b2a3.fbf37712.js"],"3629b0d3":["/3629b0d3.18680dfa.js"],"378c50ad":["/378c50ad.d573b18a.js"],"3c68acf0":["/3c68acf0.59f9e963.js"],"3e2ad6aa":["/3e2ad6aa.34d1f2cc.js"],"3f19e1c7":["/3f19e1c7.68f22a9c.js"],"3f4d0ab7":["/3f4d0ab7.1bd3c07a.js"],"4142f602":["/4142f602.ce3d70ce.js"],"4667277a":["/4667277a.4c5c2b37.js"],"4794a39c":["/4794a39c.1e27f8b4.js"],"484cf785":["/484cf785.f2e08ccf.js"],"4899252d":["/4899252d.75c0bd33.js"],"4a17176f":["/4a17176f.ca84ad8e.js"],"4adf9039":["/4adf9039.49c3543f.js"],"4be53141":["/4be53141.3d13ae0c.js"],"4c0e3ffa":["/4c0e3ffa.b94bb7d8.js"],"4cc0e3d3":["/4cc0e3d3.4e2dc162.js"],"4f0f6519":["/4f0f6519.79a0385e.js"],"4f5d5dba":["/4f5d5dba.d0b4549b.js"],"4fb0d123":["/4fb0d123.9aa9c260.js"],"51c882b6":["/51c882b6.57459189.js"],"51f8d823":["/51f8d823.0960f409.js"],"537c2f50":["/537c2f50.a2d3f094.js"],"59811ff6":["/59811ff6.b8ea73a9.js"],"59fc430a":["/59fc430a.ac9f6d66.js"],"5a8467c8":["/5a8467c8.0b5d5352.js"],"5b9e3eb2":["/5b9e3eb2.377a619c.js"],"5cb198ff":["/5cb198ff.92baabc8.js"],"5e1a6a97":["/5e1a6a97.0f579b95.js"],"6070acdb":["/6070acdb.51d32c07.js"],"62bccefa":["/62bccefa.d90c77d9.js"],"64f72856":["/64f72856.aa4f1a7d.js"],"66c6a531":["/66c6a531.3ccff2b2.js"],"671df222":["/671df222.c48b339b.js"],"682f37e2":["/682f37e2.c2ec93da.js"],"6875c492":["/6875c492.afdef6fa.css","/6875c492.40b79ada.js"],"68e569b5":["/68e569b5.800cb7e8.js"],"6af29d63":["/6af29d63.d79bd98c.js"],"6c161efb":["/6c161efb.701370ea.js"],"6cf5e099":["/6cf5e099.8474eb15.js"],"6eb034f5":["/6eb034f5.4715fedf.js"],"6f88babc":["/6f88babc.a6067b59.js"],"6f98f38e":["/6f98f38e.88b519e0.js"],"7031724a":["/7031724a.3921508a.js"],"710595e7":["/710595e7.a9d7f775.js"],"723dd439":["/723dd439.66debe69.js"],"7355169f":["/7355169f.aca7b4ea.js"],"745056e3":["/745056e3.9d5f9655.js"],"74a8fb27":["/74a8fb27.16ad7c6d.js"],"7545e907":["/7545e907.f938b202.js"],"770ed746":["/770ed746.b8ea0584.js"],"7ac3ca8e":["/7ac3ca8e.c62354ab.js"],"7ce54129":["/7ce54129.115b56bb.js"],"7e1ac88a":["/7e1ac88a.0edd7362.js"],"7e71957c":["/7e71957c.3206a9ea.js"],"7efd278f":["/7efd278f.c046b8be.js"],"7f619baf":["/7f619baf.93563954.js"],"7fa9a6c2":["/7fa9a6c2.e12d4caa.js"],"7fea6da0":["/7fea6da0.8826670e.js"],"817390e5":["/817390e5.0984426f.js"],"8529cbe9":["/8529cbe9.17c6f21d.js"],"85bda95d":["/85bda95d.f6e2e219.js"],"8982087a":["/8982087a.952e974f.js"],"8cc9f486":["/8cc9f486.314ae928.js"],"8d0745e1":["/8d0745e1.482e5793.js"],"8d824fee":["/8d824fee.9a550675.js"],"8e9f0a8a":["/8e9f0a8a.688b17a0.js"],"8f8deba3":["/8f8deba3.1e911a5d.js"],"90da8313":["/90da8313.8450b746.js"],"937ab0da":["/937ab0da.e33d3d60.js"],"95a0c517":["/95a0c517.1bc18094.js"],"96e3c932":["/96e3c932.1f554e08.js"],"975f0566":["/975f0566.0f138620.js"],"980d50b9":["/980d50b9.f5404fef.js"],"99cfb617":["/99cfb617.4c3b2112.js"],"9b4e020f":["/9b4e020f.8d90035c.js"],"9c491b6a":["/9c491b6a.3ed16afd.js"],"9c9e4252":["/9c9e4252.6d9f0665.js"],"9e8eb6f8":["/9e8eb6f8.8f3e2ee5.js"],"a4581a69":["/a4581a69.8ccdfbe9.js"],"a5f726cf":["/a5f726cf.d9cd463a.js"],"a6aa9e1f":["/a6aa9e1f.afdef6fa.css","/a6aa9e1f.60c65749.js"],"a7861818":["/a7861818.5c578d31.js"],"a8771adf":["/a8771adf.cea2071e.js"],"a9cce560":["/a9cce560.b51d9f4c.js"],"ac07380c":["/ac07380c.e8afb3da.js"],"ad4eb310":["/ad4eb310.e7a48979.js"],"ae634515":["/ae634515.3f5a0118.js"],"af172acd":["/af172acd.74c40c0b.js"],"b00b6cc6":["/b00b6cc6.497ba9de.js"],"b097e5f6":["/b097e5f6.26751201.js"],"b1b7ca81":["/b1b7ca81.e440d07a.js"],"b31e5cf6":["/b31e5cf6.5ea96035.js"],"b3f6b08b":["/b3f6b08b.893fa8df.js"],"b4641276":["/b4641276.b7e645b1.js"],"b7e1ae54":["/b7e1ae54.854c9747.js"],"b937dc4e":["/b937dc4e.0d54d19b.js"],"b97bf4c3":["/b97bf4c3.d7bc3702.js"],"ba58dd52":["/ba58dd52.23627824.js"],"ba6c5c63":["/ba6c5c63.a9b724ac.js"],"bdd709f1":["/bdd709f1.299feb8e.js"],"be367357":["/be367357.66ef9370.js"],"bf1ff372":["/bf1ff372.71bb9dca.js"],"c1b57524":["/c1b57524.302d5805.js"],"c31c8869":["/c31c8869.f3e27e95.js"],"c358f84c":["/c358f84c.581b2fb4.js"],"c3707476":["/c3707476.7da03352.js"],"c4f5d8e4":["/c4f5d8e4.9f99729b.css","/c4f5d8e4.4c5f13e8.js"],"c525cd0c":["/c525cd0c.6a8c3087.js"],"c5989482":["/c5989482.ff437e75.js"],"c814305f":["/c814305f.7ee2824a.js"],"c85a0556":["/c85a0556.2aa2c5f4.js"],"c8d81af2":["/c8d81af2.86530702.js"],"c9f5a1ff":["/c9f5a1ff.a59648c7.js"],"cc1b2ba9":["/cc1b2ba9.530afaf5.js"],"cc899c7e":["/cc899c7e.45e5519a.js"],"ccc49370":["/ccc49370.afdef6fa.css","/ccc49370.6adb7d37.js"],"ce051679":["/ce051679.63bc22d6.js"],"cf94a3a3":["/cf94a3a3.389b8384.js"],"d349c250":["/d349c250.fcf1f23d.js"],"d45aaf0b":["/d45aaf0b.aec084e8.js"],"d5b6e4a9":["/d5b6e4a9.85ceb4bf.js"],"d5e44f4e":["/d5e44f4e.51dc7b88.js"],"d610846f":["/d610846f.22b81fd9.js"],"d6cba177":["/d6cba177.46224145.js"],"d6f13198":["/d6f13198.a5342b28.js"],"d9ae6871":["/d9ae6871.a6be073b.js"],"d9f5ef6a":["/d9f5ef6a.3985029f.js"],"de445c44":["/de445c44.75a1c38b.js"],"e0d32fe5":["/e0d32fe5.4ba1a266.js"],"e0edcde2":["/e0edcde2.a9a41a8b.js"],"e387c2b8":["/e387c2b8.2056e2ff.js"],"e77af92e":["/e77af92e.30e0c992.js"],"eb7d0b32":["/eb7d0b32.7872c7e9.js"],"ebe6d24f":["/ebe6d24f.a627a05c.js"],"f0496db0":["/f0496db0.eb1900d8.js"],"f10263ea":["/f10263ea.99e47ba6.js"],"f1a8d6b5":["/f1a8d6b5.afd3eda1.js"],"f7ff8946":["/f7ff8946.2cb37a8b.js"],"f9310b79":["/f9310b79.63d271d8.js"],"fab67ac2":["/fab67ac2.84006d98.js"],"fbbe250b":["/fbbe250b.788bfbda.js"],"fbd29a1c":["/fbd29a1c.f7d2a287.js"],"fca90fd8":["/fca90fd8.2d472b3e.js"],"fda35bac":["/fda35bac.42c979a5.js"],"fe20272f":["/fe20272f.a05f6308.js"],"fecabaa4":["/fecabaa4.d0bae164.js"],"fef17072":["/fef17072.769a1406.js"]};/*]]>*/</script>

<title data-react-helmet="true">Detailed design using Node.js</title>

<meta data-react-helmet="true" http-equiv="x-ua-compatible" content="ie=edge"/><meta data-react-helmet="true" property="og:title" content="OpenHIM Â· Simplifying Interoperability"/><meta data-react-helmet="true" name="twitter:card" content="summary"/><meta data-react-helmet="true" name="description" content="**Note:** this design document was written before the development OpenHIM an as such some of the detail have changed or evolved with the OpenHIM&#x27;s continuted development. It is a good starting point but not a complete picture."/><meta data-react-helmet="true" property="og:description" content="**Note:** this design document was written before the development OpenHIM an as such some of the detail have changed or evolved with the OpenHIM&#x27;s continuted development. It is a good starting point but not a complete picture."/><meta data-react-helmet="true" property="og:url" content="https://jembi.github.io/docs/dev-guide/design-details"/>

<link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"/>


<link rel="stylesheet" type="text/css" href="/main.890859af.css" />

<link rel="stylesheet" type="text/css" href="/0.ee9bd68e.css" />

<link rel="stylesheet" type="text/css" href="/1.23b9b4f0.css" />

<link rel="stylesheet" type="text/css" href="/1be78505.a7dc664a.css" />

<link rel="stylesheet" type="text/css" href="/17896441.5eb77786.css" />

</head>
<body >
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/openhim-logo-green.svg" alt="OpenHIM"/></a><a class="navbar__item navbar__link" href="/docs/introduction/about">Docs</a><a class="navbar__item navbar__link" href="/docs/api/introduction/welcome">API</a><a class="navbar__item navbar__link" href="/mediator-library">Mediator Library</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus">GitHub</a><div class="react-toggle displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_16vC moon_1N64"></span></div><div class="react-toggle-track-x"><span class="toggle_16vC sun_3CZP"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"/></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/"><img class="navbar__logo" src="/img/openhim-logo-green.svg" alt="OpenHIM"/></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction/about">Docs</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/api/introduction/welcome">API</a></li><li class="menu__list-item"><a class="menu__link" href="/mediator-library">Mediator Library</a></li><li class="menu__list-item"><a class="menu__link" target="_blank" rel="noopener noreferrer" href="https://github.com/facebook/docusaurus">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive"><button aria-label="Open Menu" class="button button--secondary button--sm menu__button" type="button"><svg class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Introduction</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/introduction/about">About the OpenHIM</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/introduction/key-components">Key Components</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/introduction/roadmap">Roadmap</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/introduction/community">Community</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Installation</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/installation/manual">Install Manually</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation/docker">Install via Docker</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation/npm">Install via NPM</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation/virtual-machine">Install via Virtual Machine</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/installation/console-configuration">Console Configuration</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Tutorial</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial/prerequisite">Prerequisite</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial/installation">Installation</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial/configuration">Configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/tutorial/mediator">Building a Mediator</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">User Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/overview">OpenHIM Overview</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/basic-configuration">Basic configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/adding-users">Adding Users</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/transaction-list">Transaction List</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/alerting-reports">Alerting and reports</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/polling-channels">Polling Channels (scheduled tasks)</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/certificates-keystore">Certificates &amp; Keystore</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/mediators">Mediators</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/sample-disaster-recovery-procedure">Sample disaster recovery procedure</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/openhim-core-versioning-and-compatibility">OpenHIM Core versioning and compatibility</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/user-guide/auditing">Auditing</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Developer Guide</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/dev-guide/design-overview">Design overview</a></li><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/docs/dev-guide/design-details">Detailed design using Node.js</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dev-guide/openhim-development">Getting started with OpenHIM development</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dev-guide/developing-mediators">Developing mediators</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dev-guide/restful-api">RESTful API</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/dev-guide/contributing">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Implementations</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/implementations/datim">DATIM</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/implementations/mhero">mHero</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/implementations/momconnect">MomConnect</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/implementations/openhie">OpenHIE</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">How to</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/setup-and-configure">Setup and configure the OpenHIM</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/openhim-core-release">Create an OpenHIM-core release</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/openhim-console-release">Create an OpenHIM-console release</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/build-centos-rpm-package">Build a CentOS RPM package</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/install-on-centos">Install on CentOS</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/setup-ssl">Setup SSL</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/pre-package-offline-release">Pre-package an offline OpenHIM-core release</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/run-openhim-using-vagrant">Run the OpenHIM using vagrant</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/run-openhim-on-startup">Run the OpenHIM on startup</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/export-import-configuration">Export/import Configuration</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/setup-basic-cluster">Setup a basic cluster</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/manually-install-on-ubuntu-trusty">Manually install on Ubuntu 14.04 Trusty</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/manually-install-on-windows">Manually install on Windows</a></li><li class="menu__list-item"><a class="menu__link" href="/docs/how-to/build-openhim-documentation">Build the documentation</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Detailed design using Node.js</h1></header><div class="markdown"><p><strong>Note:</strong> this design document was written before the development OpenHIM an as such some of the detail have changed or evolved with the OpenHIM&#x27;s continuted development. It is a good starting point but not a complete picture.</p><p>Node.js is a good technology option on which to develop the interoperability layer core component for the following reasons:</p><ul><li>It is very lightweight</li><li>It has a robust HTTP library</li><li>It has robust support from 3rd party libraries for reading and modifying HTTP requests</li><li>It is highly performant</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="libraries-to-use"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#libraries-to-use">#</a>Libraries to use</h2><ul><li><a href="http://koajs.com/">Koa</a> - Koa is a new web application framework for node.js. It provides easy mechanisms to expose web endpoints and process requests and responses in a stack-like approach.</li><li><a href="http://passportjs.org/">Passport.js</a> - Middleware to provide authentication mechanisms (in the current implementation this has not yet been used).</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="general-overview"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#general-overview">#</a>General Overview</h2><p>The Koa framework provides an easy way to modify HTTP request and responses as they are being processed. Each step that the OpenHIM needs to perform can be written as Koa middleware. Each middleware can handle a different aspect of processing that the OpenHIM need to perform such as authentication, authorization, message persistence and message routing. Developing each of these steps as Koa middleware allows them to be easily reused and allows us to add new steps for future versions. Koa stack approach to processing requests also fit our use case well as it allows the middleware to affect both the request and the response as it is travelling through the system.</p><p>The Koa framework also gives us some convenience ctx.request and ctx.response objects that are designed to be used for web applications but they are equally useful for handling web services.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="design"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#design">#</a>Design</h2><p>The OpenHIM-core will use Koa middleware to act on HTTP requests and Responses. Koa allows you to setup a stack of middleware, each middleware is called in order and gets an opportunity to do something with the request (going down the stack) and is then suspended. Once the end of the stack is reached Koa traverses back up the stack allowing each middleware to do something with the response.</p><p>Each row in the diagram representing the OpenHIM-core is a middleware component. Each of the components of the OpenHIM-core will be described further in the following sections. The OpenHIM-core will also have a REST API that will allow a web UI to be created for easy of management.</p><p><img src="assets/design/OpenHIM-js-design.png" alt="openhim-design"/></p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="authentication-and-authorization"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#authentication-and-authorization">#</a>Authentication and Authorization</h2><p>The are two possible combinations of authentication that the interoperability layer should provide to determine a client&#x27;s identity:</p><ul><li>HTTP basic authentication</li><li>ATNAs Node Authentication (PKI)</li></ul><p>Once identify has been established the IL core component should check if that client has the authority to access the requested service.</p><p>The HIM should also provide a single-sign-on (SSO) facility to allow users of the HIE management application to have a single identity that they may used to access these applications. To do this the HIM should also act as an openid provider and provide functions to manage SSO users.</p><p>The two main workflows that we wish to enable for authentication and authorization are described in the following workflows:</p><ul><li><a href="https://wiki.ohie.org/display/documents/Common+message+security+workflow">Common message security workflow</a></li><li><a href="https://wiki.ohie.org/display/documents/SSO+User+workflow">SSO User workflow</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="authentication"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#authentication">#</a>Authentication</h3><p>Client details for authentication are stored in the MongoDB database in the following format. Either a password or a certificate (in binary form) is stored in this structure depending on whether the user chooses to use PKI or HTTP basic auth to authenticate clients.</p><p>The OpenHIM application should allow new clients to be added and managed with the following details:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-js codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;clientID&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Musha_OpenMRS&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;domain&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;him.jembi.org&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;name&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;OpenMRS Musha instance&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;roles&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;OpenMRS_PoC&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;PoC&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;passwordHash&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;cert&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="basic-auth"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#basic-auth">#</a>Basic auth</h4><p>When authentication is set to HTTP basic auth then Koa middleware is setup to intercept the request as soon as it enters the HIM as shown above. This middleware will read client details (username and password-hash) out of the MongoDB store to determine if the client can be authenticated. If the client is rejected an error is returned else the request is considered authenticated and is then passed onto the authorization step.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor" id="pki---mutual-tls"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#pki---mutual-tls">#</a>PKI - mutual TLS</h4><p>When the authentication method is set to PKI then the node http server must be setup to use https and it must be set to trust only clients that have a certificate that it knows of (is stored in a client&#x27;s details). The domain of a client (identified in its certificate) will be used to map a request received from a client to its details as stored by the OpenHIM (shown above).</p><p>To help perform the authentication the <a href="http://passportjs.org/">passport.js</a> module will be used. This provides us with middleware for a number of different authentication schemes. There is also <a href="https://github.com/rkusa/koa-passport">Koa middleware available for passport</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="authorization"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#authorization">#</a>Authorization</h3><p>The OpenHIM only performs simple authorisation based on the path that is being requested. It should be able to restrict access to certain paths to clients with particular roles. Roles are identified in each client&#x27;s details. The channel description shown in the router section below shows that each path has one or more allowed roles or clients associated with it. The authorisation component will check if the authenticated client has the authority to access the current path. If authorized the request will be passed on, else, the request will be denied and a HTTP 401 message will be returned.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="message-persistence"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#message-persistence">#</a>Message persistence</h2><p>Each request and response will be persisted so that it can be logged and so that the erroneous transaction may be re-run. This persistence occurs at two stages. Firstly, once a request is authenticated and authorised and secondly once a response has been received from the external service. All the metadata about a transaction is stored in a single document in MongoDB. The relevant sections are just updated as new information is received. The structure of this information is shown below.</p><p>In addition the ability to store orchestration steps exists in the structure. We anticipate exposing a web service to enable mediators to report requests and responses that they make to/receive from external services and have these stored alongside the actual transaction.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-json codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;_id&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;123&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Processing|Failed|Completed&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;clientID&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Musha_OpenMRS&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;request&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;path&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;/api/test&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;headers&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;header1&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;header2&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value2&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;querystring&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;param1=value1&amp;param2=value2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;body&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;HTTP body&gt;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;method&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;POST&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;timestamp&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;ISO 8601&gt;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;response&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;status&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">201</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;body&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;HTTP body&gt;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;headers&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;header1&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;header2&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value2&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;timestamp&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;ISO 8601&gt;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;routes&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;route name&gt;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Same structure as above</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;request&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> ... </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;response&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> ... </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;orchestrations&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&lt;orchestration name&gt;&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Same structure as above</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;request&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> ... </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token property">&quot;response&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> ... </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;properties&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// optional meta data about a transaction</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;prop1&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value1&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;prop2&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value2&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="router"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#router">#</a>Router</h2><p>The router allows requests to be forwarded to one or more external services (these could be mediators or an actual HIE component). It does this by allowing the user to configure a number of channels. Each channel matches a certain path and contains a number of routes on which to forward requests. Request may be forwarded to multiple routes however there can only be one <strong>primary route</strong>. The primary route is a the route whose response is returned back to the service requester making use of the OpenHIM.</p><p>Channels may be added, removed or updated dynamically as the application is running.</p><p>A channel may be access controlled via the &#x27;allow&#x27; field. This field will specify a list of users or groups that are allowed to send requests to that channel. If a channel receives a request from an un-authorised source it will return an error.</p><p>A custom router will have to be developed that can route according to these rules. The router can be built using the node.js functions provided to make HTTP requests and responses can be relayed using the .pipe() function.</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-json codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Some Registry Channel&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;urlPattern&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;test/sample/.+&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;allow&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;*&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;routes&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Some Registry&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;path&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;some/other/path&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// this is optional if left out original path is used</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;host&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;port&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8080</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;properties&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// optional meta data about a channel</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token property">&quot;prop1&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value1&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token property">&quot;prop2&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value2&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Some Registry Channel&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;urlPattern&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;test/sample2/.+/test2&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;allow&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Alice&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Bob&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;PoC&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;routes&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Some Registry&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;host&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;localhost&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;port&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">8080</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;primary&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Logger&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;host&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;log-host&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token property">&quot;port&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">4789</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token property">&quot;properties&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// optional meta data about a channel</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token property">&quot;prop1&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value1&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"> </span><span class="token property">&quot;prop2&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;value2&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre><h2><a aria-hidden="true" tabindex="-1" class="anchor" id="restful-api"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#restful-api">#</a>Restful API</h2><p>The OpenHIM must also expose a restful API that enables it to be configured and to allow access to the logged transactions. This restful API will drive a web application that can allow the OpenHIM to be configured and will allow transactions to be viewed and monitored.</p><p>The API must supply CRUD access to the following constructs:</p><ul><li>transaction logs</li><li>transaction channels</li><li>client details</li></ul><p>It should also allow for the following actions:</p><ul><li>single and batch re-processing of transactions</li><li>querying for monitoring statistics</li></ul><p>The API reference as it currently exists can be <a href="./dev-guide/api-ref.html">found here</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor" id="api-authentication"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#api-authentication">#</a>API Authentication</h3><p>For details follow the following issue: <a href="https://github.com/jembi/openhim-core-js/issues/57#issuecomment-44835273">https://github.com/jembi/openhim-core-js/issues/57#issuecomment-44835273</a></p><p>The users collection should look as follows:</p><pre class="mdxCodeBlock_iHAB"><div class="codeBlockWrapper_2QGZ"><pre class="prism-code language-json codeBlock_19pQ" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;firstname&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Ryan&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;surname&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Crichton&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;email&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;r..@jembi.org&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;username&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;ryan.crichton&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;passwordHash&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xxxxx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;passwordSalt&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;xxxxx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;apiKey&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;fd41f5da-b059-45e8-afc3-99896ee5a7a4&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;groups&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Admin&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;RHIE&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button></div></pre></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/dev-guide/design-overview"><h5 class="pagination-nav__link--sublabel">Previous</h5><h4 class="pagination-nav__link--label">Â« <!-- -->Design overview</h4></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/dev-guide/openhim-development"><h5 class="pagination-nav__link--sublabel">Next</h5><h4 class="pagination-nav__link--label">Getting started with OpenHIM development<!-- --> Â»</h4></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#libraries-to-use" class="contents__link">Libraries to use</a></li><li><a href="#general-overview" class="contents__link">General Overview</a></li><li><a href="#design" class="contents__link">Design</a></li><li><a href="#authentication-and-authorization" class="contents__link">Authentication and Authorization</a><ul class=""><li><a href="#authentication" class="contents__link">Authentication</a></li><li><a href="#authorization" class="contents__link">Authorization</a></li></ul></li><li><a href="#message-persistence" class="contents__link">Message persistence</a></li><li><a href="#router" class="contents__link">Router</a></li><li><a href="#restful-api" class="contents__link">Restful API</a><ul class=""><li><a href="#api-authentication" class="contents__link">API Authentication</a></li></ul></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Docs</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/doc1">Docs</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" target="_blank" rel="noopener noreferrer" href="https://discordapp.com/invite/docusaurus">Discord</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Social</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li></ul></div></div><div class="text--center"><div class="margin-bottom--sm"><a href="https://opensource.facebook.com/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_1Wg7"><img class="footer__logo" alt="Facebook Open Source Logo" src="https://docusaurus.io/img/oss_logo.png"/></a></div>Copyright Â© 2019 Facebook, Inc. Built with Docusaurus.</div></div></footer>
</div>

<script type="text/javascript" src="/runtime~main.08b91b4b.js"></script>

<script type="text/javascript" src="/main.8982d4c2.js"></script>

<script type="text/javascript" src="/0.3098e6ab.js"></script>

<script type="text/javascript" src="/1.3099a30b.js"></script>

<script type="text/javascript" src="/1be78505.07533e7a.js"></script>

<script type="text/javascript" src="/9c9e4252.6d9f0665.js"></script>

<script type="text/javascript" src="/17896441.a0636878.js"></script>

<script type="text/javascript" src="/d5b6e4a9.85ceb4bf.js"></script>

<script type="text/javascript" src="/f7ff8946.2cb37a8b.js"></script>

</body>
</html>