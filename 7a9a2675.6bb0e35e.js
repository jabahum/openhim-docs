/*! For license information please see 7a9a2675.6bb0e35e.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[109],{193:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return c})),n.d(t,"rightToc",(function(){return i})),n.d(t,"default",(function(){return p}));n(311),n(12),n(53),n(315),n(317),n(0);var r=n(302),a=n(308),s=n(309);function o(){return(o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var c={id:"authentication",title:"API Authentication",sidebar_label:"Authentication"},i=[{value:"Examples",id:"examples",children:[]}],u={rightToc:i},l="wrapper";function p(e){var t=e.components,n=function(e,t){if(null==e)return{};var n,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,["components"]);return Object(r.b)(l,o({},u,n,{components:t,mdxType:"MDXLayout"}),Object(r.b)("p",null,"To be able to communicate with the OpenHIM we need to ensure we have successfully generated the valid request headers for the API to verify we are allowed to interact with it. "),Object(r.b)("h2",{id:"examples"},"Examples"),Object(r.b)("p",null,"Below are a few examples of how to achieve the correct request headers to authenticate to the OpenHIM API"),Object(r.b)(a.a,{defaultValue:"nodejs",values:[{label:"NodeJS",value:"nodejs"},{label:"Bash",value:"bash"}],mdxType:"Tabs"},Object(r.b)(s.a,{value:"nodejs",mdxType:"TabItem"},Object(r.b)("pre",null,Object(r.b)("code",o({parentName:"pre"},{className:"language-javascript"}),"// openhim-api.js\n\nconst crypto = require('crypto')\nconst request = require('request')\n\n// authenticate the username is valid\nconst authenticate = async (options) => {\n  return new Promise((resolve, reject) => {\n    // authenticate the username\n    let reqOptions = {\n      url: `${options.apiURL}/authenticate/${options.username}`,\n      rejectUnauthorized: options.rejectUnauthorized\n    }\n\n    request.get(reqOptions, (err, resp, body) => {\n      if (err){\n        return reject(err)\n      }\n      // if user isn't found\n      if (resp.statusCode !== 200) {\n        return reject(new Error(`User ${options.username} not found when authenticating with core API`))\n      }\n      try {\n        body = JSON.parse(body)\n        resolve(body)\n      } catch (err) {\n        reject(err)\n      }\n    })\n  })\n}\n\n// Generate the relevant auth headers\nconst genAuthHeaders = async (options) => {\n  const authDetails = await authenticate(options)\n\n  const salt = authDetails.salt\n  const now = new Date()\n\n  // create passhash\n  let shasum = crypto.createHash('sha512')\n  shasum.update(salt + options.password)\n  const passhash = shasum.digest('hex')\n\n  // create token\n  shasum = crypto.createHash('sha512')\n  shasum.update(passhash + salt + now)\n  const token = shasum.digest('hex')\n\n  // define request headers with auth credentials\n  return {\n    'auth-username': options.username,\n    'auth-ts': now,\n    'auth-salt': salt,\n    'auth-token': token\n  }\n}\n"))),Object(r.b)(s.a,{value:"bash",mdxType:"TabItem"},Object(r.b)("p",null,"When creating your bash file, ensure the bash script is executable"),Object(r.b)("pre",null,Object(r.b)("code",o({parentName:"pre"},{className:"language-bash"}),'# openhim-api.sh\n\n#!/bin/bash\n\nif (( $# < 2)); then\n    echo "OpenHIM API: Curl wrapper that sets up the appropriate OpenHIM authentication headers";\n    echo "Usage: $0 USERNAME PASSWORD [CURL_ARGS...]";\n    exit 0;\nfi\n\nusername=$1;\npass=$2;\nshift;\nshift;\n\n# which server?\nserver=""\nfor arg in $@; do\n    match=`echo $arg | grep http | perl -pe \'s|(https?://.*?)/.*|\\1|\'`;\n    if [ "$match" ]; then\n        server=$match;\n    fi\ndone\n\nif [ ! "$server" ]; then\n    echo "OpenHIM server not specified";\n    exit 0;\nfi\n\nauth=`curl -k -s $server/authenticate/$username`;\nsalt=`echo $auth | perl -pe \'s|.*"salt":"(.*?)".*|\\1|\'`;\nts=`echo $auth | perl -pe \'s|.*"ts":"(.*?)".*|\\1|\'`;\n\npasshash=`echo -n "$salt$pass" | shasum -a 512 | awk \'{print $1}\'`;\ntoken=`echo -n "$passhash$salt$ts" | shasum -a 512 | awk \'{print $1}\'`;\n\ncurl -k -H "auth-username: $username" -H "auth-ts: $ts" -H "auth-salt: $salt" -H "auth-token: $token" $@;\necho "";\n')))))}p.isMDXComponent=!0},302:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return p}));var r=n(0),a=n.n(r),s=a.a.createContext({}),o=function(e){var t=a.a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):Object.assign({},t,e)),n},c=function(e){var t=o(e.components);return a.a.createElement(s.Provider,{value:t},e.children)};var i="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.a.createElement(a.a.Fragment,{},t)}},l=Object(r.forwardRef)((function(e,t){var n=e.components,r=e.mdxType,s=e.originalType,c=e.parentName,i=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&-1===t.indexOf(r)&&(n[r]=e[r]);return n}(e,["components","mdxType","originalType","parentName"]),l=o(n),p=r,h=l[c+"."+p]||l[p]||u[p]||s;return n?a.a.createElement(h,Object.assign({},{ref:t},i,{components:n})):a.a.createElement(h,Object.assign({},{ref:t},i))}));function p(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=n.length,o=new Array(s);o[0]=l;var c={};for(var u in t)hasOwnProperty.call(t,u)&&(c[u]=t[u]);c.originalType=e,c[i]="string"==typeof e?e:r,o[1]=c;for(var p=2;p<s;p++)o[p]=n[p];return a.a.createElement.apply(null,o)}return a.a.createElement.apply(null,n)}l.displayName="MDXCreateElement"},305:function(e,t,n){var r;!function(){"use strict";var n={}.hasOwnProperty;function a(){for(var e=[],t=0;t<arguments.length;t++){var r=arguments[t];if(r){var s=typeof r;if("string"===s||"number"===s)e.push(r);else if(Array.isArray(r)&&r.length){var o=a.apply(null,r);o&&e.push(o)}else if("object"===s)for(var c in r)n.call(r,c)&&r[c]&&e.push(c)}}return e.join(" ")}e.exports?(a.default=a,e.exports=a):void 0===(r=function(){return a}.apply(t,[]))||(e.exports=r)}()},308:function(e,t,n){"use strict";var r=n(0),a=n.n(r),s=n(305),o=n.n(s);t.a=function(e){const{block:t,children:n,defaultValue:s,values:c}=e,[i,u]=Object(r.useState)(s);return a.a.createElement("div",null,a.a.createElement("ul",{className:o()("tabs",{"tabs--block":t})},c.map(({value:e,label:t})=>a.a.createElement("li",{className:o()("tab-item",{"tab-item--active":i===e}),key:e,onClick:()=>u(e)},t))),a.a.createElement("div",{className:"margin-vert--md"},r.Children.toArray(n).filter(e=>e.props.value===i)[0]))}},309:function(e,t,n){"use strict";var r=n(0),a=n.n(r);t.a=function(e){return a.a.createElement("div",null,e.children)}},311:function(e,t,n){var r=n(51);r(r.S+r.F,"Object",{assign:n(312)})},312:function(e,t,n){"use strict";var r=n(13),a=n(35),s=n(313),o=n(314),c=n(52),i=n(54),u=Object.assign;e.exports=!u||n(34)((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=u({},e)[n]||Object.keys(u({},t)).join("")!=r}))?function(e,t){for(var n=c(e),u=arguments.length,l=1,p=s.f,h=o.f;u>l;)for(var f,m=i(arguments[l++]),b=p?a(m).concat(p(m)):a(m),d=b.length,v=0;d>v;)f=b[v++],r&&!h.call(m,f)||(n[f]=m[f]);return n}:u},313:function(e,t){t.f=Object.getOwnPropertySymbols},314:function(e,t){t.f={}.propertyIsEnumerable},315:function(e,t,n){"use strict";var r=n(316),a={};a[n(11)("toStringTag")]="z",a+""!="[object z]"&&n(18)(Object.prototype,"toString",(function(){return"[object "+r(this)+"]"}),!0)},316:function(e,t,n){var r=n(55),a=n(11)("toStringTag"),s="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=Object(e),a))?n:s?r(t):"Object"==(o=r(t))&&"function"==typeof t.callee?"Arguments":o}},317:function(e,t,n){var r=n(52),a=n(35);n(318)("keys",(function(){return function(e){return a(r(e))}}))},318:function(e,t,n){var r=n(51),a=n(17),s=n(34);e.exports=function(e,t){var n=(a.Object||{})[e]||Object[e],o={};o[e]=t(n),r(r.S+r.F*s((function(){n(1)})),"Object",o)}}}]);